<!-- TMPL_INCLUDE NAME="doc-head-open.inc" -->
<title>Koha &rsaquo; Tools &rsaquo; Inventory</title>
<!-- TMPL_INCLUDE NAME="doc-head-close.inc" -->
<link rel="stylesheet" type="text/css" href="<!-- TMPL_VAR NAME="themelang" -->/css/datatables.css" />
<script type="text/javascript" src="<!-- TMPL_VAR name="themelang" -->/lib/jquery/plugins/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="<!-- TMPL_VAR name="themelang" -->/js/datatables.js"></script>
<!-- TMPL_INCLUDE NAME="calendar.inc" -->
<script type="text/javascript" src="<!-- TMPL_VAR name="themelang" -->/lib/jquery/plugins/jquery.checkboxes.min.js"></script>
<script type="text/javascript">
//<![CDATA[
$(document).ready(function(){

        inventorydt = $('#inventoryt').dataTable({
            'bProcessing': true,
            'bServerSide': true,
            'bFilter': false,
            'bSort': false,
            'sAjaxSource': '/cgi-bin/koha/tools/tables/inventory.pl',
            'fnServerData': function(sSource, aoData, fnCallback) {
                aoData.push({
                  'name': 'borrowernumber',
                  'value': '<!-- TMPL_VAR NAME="borrowernumber" -->',
                },
                {
                  'name': 'op',
                  'value': 'do_it',

                },
                {
                  'name': 'uploadbarcodes',
                  'value': '<!-- TMPL_VAR NAME="uploadbarcodes" -->',

                },
                {
                  'name': 'minlocation',
                  'value': '<!-- TMPL_VAR NAME="minlocation" -->',

                },
                {
                  'name': 'maxlocation',
                  'value': '<!-- TMPL_VAR NAME="maxlocation" -->',

                },
                {
                  'name': 'location',
                  'value': '<!-- TMPL_VAR NAME="location" -->',

                },
                {
                  'name': 'itemtype',
                  'value': '<!-- TMPL_VAR NAME="itemtype" -->',

                },
                {
                  'name': 'ignoreissued',
                  'value': '<!-- TMPL_VAR NAME="ignoreissued" -->',

                },
                {
                  'name': 'datelastseen',
                  'value': '<!-- TMPL_VAR NAME="datelastseen" -->',

                },
                {
                  'name': 'offset',
                  'value': '<!-- TMPL_VAR NAME="offset" -->',

                },
                {
                  'name': 'markseen',
                  'value': '<!-- TMPL_VAR NAME="markseen" -->',

                },
                {
                  'name': 'barcodelist',
                  'value': '<!-- TMPL_VAR NAME="barcodelist" -->',

                },
                {
                  'name': 'branchcode',
                  'value': '<!-- TMPL_VAR NAME="branchcode" -->',

                },
                {
                  'name': 'branch',
                  'value': '<!-- TMPL_VAR NAME="branch" -->',

                },
                {
                  'name': 'compareinv2barcd',
                  'value': '<!-- TMPL_VAR NAME="compareinv2barcd" -->',

                },
                {
                  'name': 'notforloanlist',
                  'value': '<!-- TMPL_VAR NAME="notforloanlist" -->',
                }

                );

                $.ajax({
                  'dataType': 'json',
                  'type': 'POST',
                  'url': sSource,
                  'data': aoData,
                  'success': fnCallback
                });
            },
            'aoColumns': [
                { "mDataProp": "dt_seen", "bSortable": false },
                { "mDataProp": "dt_barcode" },
                { "mDataProp": "dt_location" },
                { "mDataProp": "dt_title" },
                { "mDataProp": "dt_status" },
                { "mDataProp": "dt_lost" },
                { "mDataProp": "dt_damaged" },
                { "mDataProp": "dt_unseen" },
                { "mDataProp": "dt_problems" }
            ],
            'sPaginationType': 'full_numbers'
        });

	$("#continuewithoutmarkingbutton").click(function(){
                inventorydt.fnPageChange( 'next' );
	        return false;
        });

        $("#markseenandcontinuebutton").click(function(){
            var param = '';
            $("input:checked").each(function() {
                param += "|" + $(this).attr('name');
            });
            $.post('/cgi-bin/koha/tools/ajax-inventory.pl', { seen: param });
            inventorydt.fnDraw();
            inventorydt.fnPageChange( 'next' );
            return false;
        });

        $("#markseenandquit").click(function(){
            var param = '';
            $("input:checked").each(function() {
                param += "|" + $(this).attr('name');
            });
            $.ajax({
              type: 'POST',
              url: '/cgi-bin/koha/tools/ajax-inventory.pl',
              data: { seen: param},
              async: false
            });
            document.location.href = '/cgi-bin/koha/tools/inventory.pl';
            return false;
        });



	$(".checkall").click(function(){
	        $(".checkboxed").checkCheckboxes();
	        return false;
		});
	$(".clearall").click(function(){
	        $(".checkboxed").unCheckCheckboxes();
	        return false;
	    });
	$("#markback").click(function(){
		$(".checkboxed").find("input").filter("[name=offset]").attr("value","<!-- TMPL_VAR NAME="prevoffset" -->");
		return true;
	});
	$("#marknext").click(function(){
		$(".checkboxed").find("input").filter("[name=offset]").attr("value","<!-- TMPL_VAR NAME="nextoffset" -->");
		return true;
	});
	});
//]]>
</script>
</head>
<body>
<!-- TMPL_INCLUDE NAME="header.inc" -->
<!-- TMPL_INCLUDE NAME="cat-search.inc"-->

<div id="breadcrumbs"><a href="/cgi-bin/koha/mainpage.pl">Home</a> &rsaquo; <a href="/cgi-bin/koha/tools/tools-home.pl">Tools</a> &rsaquo; <!-- TMPL_IF NAME="loop" --><a href="/cgi-bin/koha/tools/inventory.pl">Inventory</a> &rsaquo; Results<!-- TMPL_ELSE -->Inventory<!-- /TMPL_IF --></div>

<div id="doc3" class="yui-t2">
   
   <div id="bd">
	<div id="yui-main">
	<div class="yui-b">
    <h1>Inventory/Stocktaking</h1>
    <!--TMPL_IF Name="moddatecount" --><div class="dialog message"><!--TMPL_VAR Name="moddatecount"--> items modified : datelastseen set to <!--TMPL_VAR Name="date"--></div><!-- /TMPL_IF-->
    <!--TMPL_IF Name="errorfile" --><div class="dialog alert"><!--TMPL_VAR Name="errorfile"--> can't be opened</div><!-- /TMPL_IF-->
    <!--TMPL_LOOP Name="errorloop"-->
        <div class="dialog alert">
            <!--TMPL_VAR Name="barcode"-->
            <!--TMPL_IF Name="ERR_BARCODE"-->: barcode not found<!--/TMPL_IF-->
            <!--TMPL_IF Name="ERR_WTHDRAWN"-->: item withdrawn<!--/TMPL_IF-->
            <!--TMPL_IF Name="ERR_ONLOAN_RET"-->: item was on loan. It was returned before marked as seen<!--/TMPL_IF-->
            <!--TMPL_IF Name="ERR_ONLOAN_NOT_RET"-->: item was on loan. couldn't be returned.<!--/TMPL_IF-->
        </div>
    <!-- /TMPL_LOOP-->
	<!-- TMPL_UNLESS name="op" -->
	<div class="yui-g">
    <form method="post" action="/cgi-bin/koha/tools/inventory.pl" enctype="multipart/form-data">
        <fieldset class="rows">
            <legend>Use a barcode file</legend>
	 <ol>
            <li><label for="uploadbarcodes">Barcode file: </label> <input type="file" id="uploadbarcodes" name="uploadbarcodes" /></li>
            <li><label for="setdate">Set inventory date to:</label> <input type="text" id="setdate" name="setdate" value="<!-- TMPL_VAR name="today" -->" />
             <img src="<!-- TMPL_VAR Name="themelang" -->/lib/calendar/cal.gif" id="setdate_button" alt="Show Calendar" />
            <script type="text/javascript">
            Calendar.setup(
            {
            inputField : "setdate",
            ifFormat : "<!-- TMPL_VAR NAME="DHTMLcalendar_dateformat" -->",
            button : "setdate_button"
            }
            );
            </script>
			<div class="hint"><!-- TMPL_INCLUDE NAME="date-format.inc" --></div>
            </li>
          </ol>
        </fieldset>
        <fieldset class="rows">
        <legend>Select items you want to check</legend>
        <ol><li>
        <label for="branch">Branch</label>
            <input type="radio" name="branch" value="homebranch">Home Branch</input>
            <input type="radio" name="branch" value="holdingbranch">Holding Branch</input>
        </li><li>
        <label for="branchloop">Library</label><select id="branchloop" name="branchcode" style="width:12em;">
            <option value="">All Locations</option>
        <!-- TMPL_LOOP NAME="branchloop" -->
            <!-- TMPL_IF name="selected" -->
                <option value="<!-- TMPL_VAR NAME="value" -->" selected="selected"><!-- TMPL_VAR NAME="branchname" --></option>
            <!-- TMPL_ELSE -->
                <option value="<!-- TMPL_VAR NAME="value" -->"><!-- TMPL_VAR NAME="branchname" --></option>
            <!-- /TMPL_IF -->
        <!-- /TMPL_LOOP -->
        </select>
        </li>
        <!-- TMPL_IF NAME="authorised_values" -->
        <li>
            <label for="locationloop">Item Location (items.location) is</label> 
        <select id="locationloop" name="location">
                <option value="">Filter location</option>
        <!-- TMPL_LOOP NAME="authorised_values" -->
            <!-- TMPL_IF name="selected" -->
                <option value="<!-- TMPL_VAR NAME="authorised_value" -->" selected="selected"><!-- TMPL_VAR NAME="lib" --></option>
            <!-- TMPL_ELSE -->
                <option value="<!-- TMPL_VAR NAME="authorised_value" -->"><!-- TMPL_VAR NAME="lib" --></option>
            <!-- /TMPL_IF -->
        <!-- /TMPL_LOOP -->
        </select>        </li>
        <!-- /TMPL_IF -->
        <li>
            <label for="minlocation">Item callnumber between: </label>
                <input type="text" name="minlocation" id="minlocation" value="<!-- TMPL_VAR NAME="minlocation" -->" /> (items.itemcallnumber)  </li>
           <li><label for="maxlocation">...and: </label>
                <input type="text" name="maxlocation" id="maxlocation" value="<!-- TMPL_VAR NAME="maxlocation" -->" />
        </li>
        <!-- TMPL_IF name="statuses" -->
	</ol>
	</fieldset>
            <fieldset class="rows">
            <legend>Item statuses:</legend>
            <div name="statuses" style="display: block;">
                  <!-- TMPL_LOOP name="statuses" -->
                      <!-- TMPL_IF name="values" -->
                          <fieldset style="float: left; padding: 5px; margin: 5px;text-align:right">
                              <legend><!-- TMPL_VAR name="fieldname" --></legend>
                              <ul id="statuses-<!-- TMPL_VAR name="fieldname" -->" style="display: inline;">
                              <!-- TMPL_LOOP name="values" -->
                                  <!-- TMPL_IF NAME="lib" --><li>
                                    <label for="<!-- TMPL_VAR name="id" -->">
                                      <!-- TMPL_VAR name="lib" -->
                                    </label>
                                    <input type="checkbox" name="status-<!-- TMPL_VAR name="fieldname" -->-<!-- TMPL_VAR name="authorised_value" -->" id="<!-- TMPL_VAR name="authorised_value" -->" />
                                  </li><!-- /TMPL_IF -->
                              <!-- /TMPL_LOOP -->
                              </ul>
                          </fieldset>
                      <!-- /TMPL_IF -->
                  <!-- /TMPL_LOOP -->
                </div>
            </fieldset>
		<fieldset class="rows">
          <ol>
        <!-- /TMPL_IF -->

        <li><label for="datelastseen">Inventory date:</label>
            <input type="text" id="datelastseen" name="datelastseen" value="<!-- TMPL_VAR NAME="datelastseen" -->" />
            <img src="<!-- TMPL_VAR Name="themelang" -->/lib/calendar/cal.gif" id="datelastseen_button" alt="Show Calendar" />
            <script type="text/javascript">
            Calendar.setup(
            {
            inputField : "datelastseen",
            ifFormat : "<!-- TMPL_VAR NAME="DHTMLcalendar_dateformat" -->",
            button : "datelastseen_button"
            }
            );
            </script>
			<div class="hint"><!-- TMPL_INCLUDE NAME="date-format.inc" --></div>
        </li>
        <li><label for="ignoreissued">Skip copies on loan: </label>
            <!-- TMPL_IF NAME="ignoreissued" -->
            <input type="checkbox" id="ignoreissued" name="ignoreissued" checked="checked" /></li>
            <!-- TMPL_ELSE -->
            <input type="checkbox" id="ignoreissued" name="ignoreissued" /></li>
            <!-- /TMPL_IF -->
        <li>
           <label for="CSVexport">Export to csv file</label>
           <input type="checkbox" name="CSVexport" id="CSVexport" />
        </li>
        <li>
            <label for="compareinv2barcd">Compare barcodes list to results</label>
            <input type="checkbox" name="compareinv2barcd" id="compareinv2barcd" />
        </li>
        </ol>
  </fieldset>
            <input type="hidden" name="op" value="do_it" />
            <fieldset class="action"><input type="submit" value="Submit" class="button" /></fieldset>
    </form>
	</div>
	</div>
	<!--/TMPL_UNLESS-->
    <!-- TMPL_IF NAME="op" -->
    <form method="post" action="/cgi-bin/koha/tools/inventory.pl" class="checkboxed">
    <input type="hidden" name="markseen" value="1" />
    <input type="hidden" name="minlocation" value="<!-- TMPL_VAR NAME="minlocation" -->" />
    <input type="hidden" name="maxlocation" value="<!-- TMPL_VAR NAME="maxlocation" -->" />
    <input type="hidden" name="location" value="<!-- TMPL_VAR NAME="location" -->" />
    <input type="hidden" name="branchcode" value="<!-- TMPL_VAR NAME="branchcode" -->" />
    <input type="hidden" name="datelastseen" value="<!-- TMPL_VAR NAME="datelastseen" -->" />
    <input type="hidden" name="pagesize" value="<!-- TMPL_VAR NAME="pagesize" -->" />
    <input type="hidden" name="offset" value="<!-- TMPL_VAR NAME="offset" -->" />
	<div style="padding : .3em 0"><a href="#" class="checkall">[Select All]</a> <a href="#" class="clearall">[Clear All]</a></div>
    <table id="inventoryt" class="display">
    <thead>
        <tr>
            <th>Seen</th>
            <th>Barcode</th>
            <th>Location</th>
            <th>Title</th>
            <th>Status</th>
            <th>Lost</th>
            <th>Damaged</th>
            <th>Unseen since</th>
            <th>Problems</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
    </table>
    <div class="spacer"></div>
      <p style="display:block;"><span class="exportSelected"></span></p>
	<div style="padding : .3em 0"><a href="#" class="checkall">[Select All]</a> <a href="#" class="clearall">[Clear All]</a></div>
     <input type="submit" id="markseenandquit" value="Mark seen and quit" />
     <input type="submit" value="Mark Seen and Continue &gt;&gt;" id="markseenandcontinuebutton" />
     <input type="submit" value="Continue without Marking &gt;&gt;" id="continuewithoutmarkingbutton" class="submit" />
    </form>
    </div>
    <!-- /TMPL_IF -->
    <!-- /TMPL_IF -->
</div>
<div class="yui-b">
<!-- TMPL_INCLUDE NAME="tools-menu.inc" -->
</div>
</div>
<!-- TMPL_INCLUDE NAME="intranet-bottom.inc" -->
